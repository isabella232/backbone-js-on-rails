<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Organization</title><meta name="generator" content="DocBook XSL Stylesheets V1.74.1"/><link rel="home" href="index.html" title="Backbone.js on Rails"/><link rel="up" href="index.html" title="Backbone.js on Rails"/><link rel="prev" href="ar01s02.html" title="Getting up to speed"/><link rel="next" href="ar01s04.html" title="Rails Integration"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Organization</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s02.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s04.html">Next</a></td></tr></table><hr/></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_organization"/>Organization</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="_backbone_and_mvc"/>Backbone and MVC</h3></div></div></div><p>Model–View–Controller (MVC) is a software architectural pattern used in many
applications to isolate domain or business logic (the application logic for the user)
from the user interface (input and presentation).</p><div class="figure"><a id="d0e126"/><p class="title"><b>Figure 1. Model-view-controller concept</b></p><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="65%"><tr><td align="center"><img src="image/MVCDiagram.png" align="middle" width="100%" alt="image/MVCDiagram.png"/></td></tr></table></div></div></div><br class="figure-break"/><p>In the above diagram a solid line represents a direct association and a dashed
line represents an indirect association, such as one mediated by an observer.</p><p>As a user of Rails, you’re likely already familiar with the concept of MVC and
the benefits that the separation of concerns can give you. However, Rails
itself is technically not traditional MVC, but a pattern called
<a class="ulink" href="http://en.wikipedia.org/wiki/Model2" target="_top">Model2</a>. A traditional MVC is event-based,
and views are bound directly to models as observers, updating themselves when
the model changes.</p><p>Given that Javascript has events, and that much of the interactions between the
different components of Backbone in the browser are not limited to
request/response, Backbone can be structured as an actual MVC architecture.</p><p>That said, technically speaking, Backbone is <span class="emphasis"><em>not</em></span> MVC, and Backbone
acknowledged this when it renamed Controllers to Routers in version 0.5.0.</p><p>What is Backbone then, if not MVC?  Classically, Views handled the presentation
of information, and Controllers would take the user input and decide what
to do with it.  In Backbone, these two concerns are merged into View classes,
which are responsible for presentation as well as both establishing and responding
to UI event bindings.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="_what_goes_where"/>What Goes Where</h3></div></div></div><p>Part of the initial learning curve of Backbone can be figuring out what goes
where, and mapping it to your expectations set by working with Rails.  In Rails
we have Models, Views, Controllers, and Routers.  In Backbone, we have
Models, Collections, Views, Templates, and Routers.</p><p>It’s important to note that, although Rails and Backbone share several concept
names, several of which have significant overlap, you shouldn’t try to map your
understanding of one directly onto the other.  That said, it’s valuable to draw
similarities to help ease the learning curve.</p><p>The models in Backbone and Rails are fairly analogous - each represents
objects in your domain, and both mix the concerns of domain logic with
persistence.  In Rails, the persistence is usually into a database, and in Backbone
it’s generally into a remote HTTP JSON API.</p><p>Backbone collections are just ordered sets of models.  Because it lacks
controllers, Backbone routers and views work together to pick up the
functionality provided by Rails controllers. Finally, in Rails, when we say
views, we actually mean templates, as Rails does not provide for View classes
out of th ebox.  In Backbone, however, you have a separation between the
view class and the HTML templates that they use.</p><p>Once you introduce Backbone into your application, you grow the layers in your
stack by four levels. This can be daunting at first, and frankly, at times it
can be difficult to keep everything going on in your application straight.
Ultimately, the additional organization and functionality of Backbone
outweighs the costs, so let’s break it down.</p><div class="itemizedlist"><p class="title"><b>Rails</b></p><ul type="disc"><li>
Model
</li><li>
Controller
</li><li>
View
</li></ul></div><div class="itemizedlist"><p class="title"><b>Backbone</b></p><ul type="disc"><li>
Model and Collection
</li><li>
Router
</li><li>
View
</li><li>
Template
</li></ul></div><p>In a typical Rails and Backbone application, the initial interaction between
the layers will be as follows:</p><div class="itemizedlist"><ul type="disc"><li>
A request from a user comes in the <span class="strong"><strong>Rails router</strong></span> identifies what should
  handle the request based on the URL
</li><li>
The <span class="strong"><strong>Rails controller action</strong></span> to handle the request is called, some initial
  processing may be performed
</li><li>
The <span class="strong"><strong>Rails view template</strong></span> is rendered and returned to the user’s browser
</li><li>
The <span class="strong"><strong>Rails view template</strong></span> will include <span class="strong"><strong>Backbone initialization</strong></span>, usually
  this is populating some <span class="strong"><strong>Backbone collections</strong></span> as sets of <span class="strong"><strong>Backbone models</strong></span>
  with JSON data provided by the <span class="strong"><strong>Rails view</strong></span>
</li><li>
The <span class="strong"><strong>Backbone router</strong></span> determines which of its methods should handle the
  display based on the URL
</li><li>
The <span class="strong"><strong>Backbone router</strong></span> calls that method, some initial processing
  may be performed, and one or more <span class="strong"><strong>Backbone views</strong></span> are rendered
</li><li>
The <span class="strong"><strong>Backbone view</strong></span> reads <span class="strong"><strong>templates</strong></span> and uses <span class="strong"><strong>Backbone</strong></span> models to
  render itself onto the page
</li></ul></div><p>At this point, the user will see your application in their browser and be able to
interact with it.  The user interacting with elements on the page will trigger
actions to be taken at any level of the above sequence: <span class="strong"><strong>Backbone model</strong></span>,
<span class="strong"><strong>Backbone views</strong></span>, <span class="strong"><strong>Backbone routers</strong></span>, or requests to the remote server.</p><p>Requests to the remote server may be any one of the following:</p><div class="itemizedlist"><ul type="disc"><li>
Normal requests that don’t hit Backbone and trigger a full page reload.
</li><li>
Normal Ajax requests, not using Backbone at all.
</li><li>
Ajax requests from the <span class="strong"><strong>Backbone model</strong></span> or <span class="strong"><strong>Backbone collection</strong></span>,
  communicating with Rails via JSON.
</li></ul></div><p>Generally speaking, by introducing Backbone into our application we’ll reduce
the first two types of requests, moving the bulk of client/server interaction
to requests encapsulated inside domain objects like Backbone models.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="_namespacing_your_application"/>Namespacing your application</h3></div></div></div><p>You will want to create an object in JavaScript for your Backbone
application to reside. This variable will serve as a namespace for your
Backbone application. Namespacing all of the JavaScript is desirable to
avoid potential collisions in naming. For example, it’s possible that a
JavaScript library you want to use might also create a Task variable. If you
didn’t namespace your Task model then this would conflict.</p><p>This variable includes a place to hold Models, Collections, Views, and Routes,
and an <code class="literal">initialize</code> function which will be called to initialize the application.</p><p>Typically, initializing your application will involve creating a Router and
starting Backbone history to route the initial URL fragment.  This app variable
will look like the following.</p><pre class="programlisting"><b class="hl-keyword">var</b> ExampleApp = {
  Models: {},
  Collections: {},
  Views: {},
  Routers: {},
  initialize: <b class="hl-keyword">function</b>() {
    <b class="hl-keyword">new</b> ExampleApp.Routers.Tasks();
    Backbone.history.start();
  }
};</pre><p>You can find a more fully fleshed-out version of this file in the example app
in <code class="literal">app/assets/javascripts/example_app.js</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="_mixins"/>Mixins</h3></div></div></div><p>Backbone provides a basic mechanism for inheritance.  Sometimes, you’ll want to
build a collection of related, reusable behavior and include that in several
classes that already inherit from a Backbone base class.  In these cases,
you’ll want to use a <a class="ulink" href="http://en.wikipedia.org/wiki/Mixin" target="_top">mixin</a>.</p><p>Backbone includes
<a class="ulink" href="http://documentcloud.github.com/backbone/#Events" target="_top">Backbone.Events</a> as an example
of a mixin.</p><p>Here, we create a mixin named <code class="literal">Observer</code> that contains behavior for binding to
events in a fashion that can be cleaned up later:</p><pre class="programlisting"><b class="hl-keyword">var</b> Observer = {
  bindTo: <b class="hl-keyword">function</b>(source, event, callback) {
    source.on(event, callback, <b class="hl-keyword">this</b>);
    <b class="hl-keyword">this</b>.bindings = <b class="hl-keyword">this</b>.bindings || [];
    <b class="hl-keyword">this</b>.bindings.push({ source: source, event: event, callback: callback });
  },

  unbindFromAll: <b class="hl-keyword">function</b>() {
    _.each(<b class="hl-keyword">this</b>.bindings, <b class="hl-keyword">function</b>(binding) {
      binding.source.off(binding.event, binding.callback);
    });
    <b class="hl-keyword">this</b>.bindings = [];
  }
};</pre><p>We can mix <code class="literal">Observer</code> into a class by using Underscore’s <code class="literal">_.extend</code> on the
prototype of that class:</p><pre class="programlisting">SomeCollectionView = Backbone.View.extend({
  initialize: <b class="hl-keyword">function</b>() {
    <b class="hl-keyword">this</b>.bindTo(<b class="hl-keyword">this</b>.collection, <b class="hl-string"><i style="color:red">"change"</i></b>, <b class="hl-keyword">this</b>.render);
  },

  leave: <b class="hl-keyword">function</b>() {
    <b class="hl-keyword">this</b>.unbindFromAll(); <i class="hl-comment" style="color: silver">// calling a method defined in the mixin</i>
    <b class="hl-keyword">this</b>.remove();
  }
});

_.extend(SomeCollectionView.<b class="hl-keyword">prototype</b>, Observer);</pre></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s02.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Getting up to speed </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Rails Integration</td></tr></table></div></body></html>