<?xml version="1.0"?>
<fo:root xmlns:fo="http://www.w3.org/1999/XSL/Format" font-family="serif,Symbol,ZapfDingbats" font-size="12pt" text-align="left" line-height="normal" font-selection-strategy="character-by-character" line-height-shift-adjustment="disregard-shifts" writing-mode="lr-tb" language="en"><fo:layout-master-set><fo:simple-page-master master-name="blank" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.5in" margin-right="0.75in"><fo:region-body display-align="center" margin-bottom="0.5in" margin-top="0.5in"/><fo:region-before region-name="xsl-region-before-blank" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-blank" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="titlepage-first" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-first" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-first" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="titlepage-odd" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-odd" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-odd" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="titlepage-even" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.5in" margin-right="0.75in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-even" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-even" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="lot-first" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-first" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-first" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="lot-odd" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-odd" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-odd" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="lot-even" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.5in" margin-right="0.75in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-even" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-even" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="front-first" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-first" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-first" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="front-odd" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-odd" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-odd" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="front-even" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.5in" margin-right="0.75in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-even" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-even" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="body-first" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-first" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-first" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="body-odd" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-odd" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-odd" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="body-even" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.5in" margin-right="0.75in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-even" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-even" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="back-first" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-first" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-first" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="back-odd" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-odd" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-odd" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="back-even" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.5in" margin-right="0.75in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="1"/><fo:region-before region-name="xsl-region-before-even" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-even" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="index-first" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="2"/><fo:region-before region-name="xsl-region-before-first" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-first" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="index-odd" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.75in" margin-right="0.5in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="2"/><fo:region-before region-name="xsl-region-before-odd" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-odd" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:simple-page-master master-name="index-even" page-width="210mm" page-height="297mm" margin-top="0.5in" margin-bottom="0.25in" margin-left="0.5in" margin-right="0.75in"><fo:region-body margin-bottom="0.5in" margin-top="0.5in" column-gap="12pt" column-count="2"/><fo:region-before region-name="xsl-region-before-even" extent="0.4in" display-align="before"/><fo:region-after region-name="xsl-region-after-even" extent="0.4in" display-align="after"/></fo:simple-page-master><fo:page-sequence-master master-name="titlepage"><fo:repeatable-page-master-alternatives><fo:conditional-page-master-reference master-reference="blank" blank-or-not-blank="blank"/><fo:conditional-page-master-reference master-reference="titlepage-first" page-position="first"/><fo:conditional-page-master-reference master-reference="titlepage-odd" odd-or-even="odd"/><fo:conditional-page-master-reference odd-or-even="even" master-reference="titlepage-odd"/></fo:repeatable-page-master-alternatives></fo:page-sequence-master><fo:page-sequence-master master-name="lot"><fo:repeatable-page-master-alternatives><fo:conditional-page-master-reference master-reference="blank" blank-or-not-blank="blank"/><fo:conditional-page-master-reference master-reference="lot-first" page-position="first"/><fo:conditional-page-master-reference master-reference="lot-odd" odd-or-even="odd"/><fo:conditional-page-master-reference odd-or-even="even" master-reference="lot-odd"/></fo:repeatable-page-master-alternatives></fo:page-sequence-master><fo:page-sequence-master master-name="front"><fo:repeatable-page-master-alternatives><fo:conditional-page-master-reference master-reference="blank" blank-or-not-blank="blank"/><fo:conditional-page-master-reference master-reference="front-first" page-position="first"/><fo:conditional-page-master-reference master-reference="front-odd" odd-or-even="odd"/><fo:conditional-page-master-reference odd-or-even="even" master-reference="front-odd"/></fo:repeatable-page-master-alternatives></fo:page-sequence-master><fo:page-sequence-master master-name="body"><fo:repeatable-page-master-alternatives><fo:conditional-page-master-reference master-reference="blank" blank-or-not-blank="blank"/><fo:conditional-page-master-reference master-reference="body-first" page-position="first"/><fo:conditional-page-master-reference master-reference="body-odd" odd-or-even="odd"/><fo:conditional-page-master-reference odd-or-even="even" master-reference="body-odd"/></fo:repeatable-page-master-alternatives></fo:page-sequence-master><fo:page-sequence-master master-name="back"><fo:repeatable-page-master-alternatives><fo:conditional-page-master-reference master-reference="blank" blank-or-not-blank="blank"/><fo:conditional-page-master-reference master-reference="back-first" page-position="first"/><fo:conditional-page-master-reference master-reference="back-odd" odd-or-even="odd"/><fo:conditional-page-master-reference odd-or-even="even" master-reference="back-odd"/></fo:repeatable-page-master-alternatives></fo:page-sequence-master><fo:page-sequence-master master-name="index"><fo:repeatable-page-master-alternatives><fo:conditional-page-master-reference master-reference="blank" blank-or-not-blank="blank"/><fo:conditional-page-master-reference master-reference="index-first" page-position="first"/><fo:conditional-page-master-reference master-reference="index-odd" odd-or-even="odd"/><fo:conditional-page-master-reference odd-or-even="even" master-reference="index-odd"/></fo:repeatable-page-master-alternatives></fo:page-sequence-master></fo:layout-master-set><fo:declarations xmlns:fox="http://xmlgraphics.apache.org/fop/extensions"><x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description xmlns:dc="http://purl.org/dc/elements/1.1/" rdf:about=""><dc:title>Backbone.js on Rails</dc:title></rdf:Description><rdf:Description xmlns:pdf="http://ns.adobe.com/pdf/1.3/" rdf:about=""/><rdf:Description xmlns:xmp="http://ns.adobe.com/xap/1.0/" rdf:about=""><xmp:CreatorTool>DocBook XSL Stylesheets with Apache FOP</xmp:CreatorTool></rdf:Description></rdf:RDF></x:xmpmeta></fo:declarations><fo:bookmark-tree><fo:bookmark internal-destination="idp4440336" starting-state="hide"><fo:bookmark-title>Backbone.js on Rails</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="toc...idp4440336"><fo:bookmark-title>Table of Contents</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_preface_section_unstarted" starting-state="hide"><fo:bookmark-title>1. Preface (section unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_getting_up_to_speed_section_unstarted" starting-state="hide"><fo:bookmark-title>2. Getting up to speed (section unstarted)</fo:bookmark-title><fo:bookmark internal-destination="_backbone_js_online_resources" starting-state="hide"><fo:bookmark-title>2.1. Backbone.js online resources</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_javascript_online_resources_and_books" starting-state="hide"><fo:bookmark-title>2.2. JavaScript online resources and books</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_introduction_section_unstarted" starting-state="hide"><fo:bookmark-title>3. Introduction (section unstarted)</fo:bookmark-title><fo:bookmark internal-destination="_why_use_backbone_js" starting-state="hide"><fo:bookmark-title>3.1. Why use Backbone.js</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_when_not_to_use_backbone_js" starting-state="hide"><fo:bookmark-title>3.2. When not to use Backbone.js</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_why_not_sproutcore_cappuccino_knockout_js_spine_etc" starting-state="hide"><fo:bookmark-title>3.3. Why not SproutCore, Cappuccino, Knockout.js, Spine, etc.</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_organization" starting-state="hide"><fo:bookmark-title>4. Organization</fo:bookmark-title><fo:bookmark internal-destination="_backbone_js_and_mvc" starting-state="hide"><fo:bookmark-title>4.1. Backbone.js and MVC</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_what_goes_where" starting-state="hide"><fo:bookmark-title>4.2. What Goes Where</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_namespacing_your_application_chapter_unstarted" starting-state="hide"><fo:bookmark-title>4.3. Namespacing your application (chapter unstarted)</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_rails_integration" starting-state="hide"><fo:bookmark-title>5. Rails Integration</fo:bookmark-title><fo:bookmark internal-destination="_organizing_your_backbone_js_code_in_a_rails_app" starting-state="hide"><fo:bookmark-title>5.1. Organizing your Backbone.js code in a Rails app</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_rails_3_0_and_prior" starting-state="hide"><fo:bookmark-title>5.2. Rails 3.0 and prior</fo:bookmark-title><fo:bookmark internal-destination="_a_note_on_jammit_and_a_jst_naming_gotcha" starting-state="hide"><fo:bookmark-title>5.2.1. A note on Jammit and a JST naming gotcha</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_rails_3_1" starting-state="hide"><fo:bookmark-title>5.3. Rails 3.1</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_converting_your_rails_models_to_backbone_js_friendly_json_chapter_unstarted" starting-state="hide"><fo:bookmark-title>5.4. Converting your Rails models to Backbone.js-friendly JSON (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_converting_an_existing_page_view_area_to_use_backbone_js_chapter_unstarted" starting-state="hide"><fo:bookmark-title>5.5. Converting an existing page/view area to use Backbone.js (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_automatically_using_the_rails_authentication_token" starting-state="hide"><fo:bookmark-title>5.6. Automatically using the Rails authentication token</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_views_and_templates" starting-state="hide"><fo:bookmark-title>6. Views and Templates</fo:bookmark-title><fo:bookmark internal-destination="_view_explanation_chapter_unstarted" starting-state="hide"><fo:bookmark-title>6.1. View explanation (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_templating_strategy_chapter_unstarted" starting-state="hide"><fo:bookmark-title>6.2. Templating strategy (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_view_helpers_chapter_unstarted" starting-state="hide"><fo:bookmark-title>6.3. View helpers (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_form_helpers_chapter_unstarted" starting-state="hide"><fo:bookmark-title>6.4. Form helpers (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_event_binding_chapter_unstarted" starting-state="hide"><fo:bookmark-title>6.5. Event binding (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_cleaning_up_understanding_binding_and_unbinding_in_progress" starting-state="hide"><fo:bookmark-title>6.6. Cleaning up: understanding binding and unbinding (in progress)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_swapping_router_in_progress" starting-state="hide"><fo:bookmark-title>6.7. Swapping router (in progress)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_composite_views_in_progress" starting-state="hide"><fo:bookmark-title>6.8. Composite views (in progress)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_how_to_use_multiple_views_on_the_same_model_collection_chapter_unstarted" starting-state="hide"><fo:bookmark-title>6.9. How to use multiple views on the same model/collection (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_internationalization_chapter_unstarted" starting-state="hide"><fo:bookmark-title>6.10. Internationalization (chapter unstarted)</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_models_and_collections" starting-state="hide"><fo:bookmark-title>7. Models and collections</fo:bookmark-title><fo:bookmark internal-destination="_naming_conventions_chapter_unstarted" starting-state="hide"><fo:bookmark-title>7.1. Naming conventions (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_nested_resources_chapter_unstarted" starting-state="hide"><fo:bookmark-title>7.2. Nested resources (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_model_associations" starting-state="hide"><fo:bookmark-title>7.3. Model associations</fo:bookmark-title><fo:bookmark internal-destination="_belongs_to_associations" starting-state="hide"><fo:bookmark-title>7.3.1. Belongs to associations</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_has_many_associations" starting-state="hide"><fo:bookmark-title>7.3.2. Has many associations</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_scopes_and_filters" starting-state="hide"><fo:bookmark-title>7.4. Scopes and filters</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_sorting" starting-state="hide"><fo:bookmark-title>7.5. Sorting</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_client_server_duplicated_business_logic_chapter_unstarted" starting-state="hide"><fo:bookmark-title>7.6. Client/Server duplicated business logic (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_validations_chapter_unstarted" starting-state="hide"><fo:bookmark-title>7.7. Validations (chapter unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_synchronizing_between_clients_chapter_unstarted" starting-state="hide"><fo:bookmark-title>7.8. Synchronizing between clients (chapter unstarted)</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_binding_models_and_views_section_unstarted" starting-state="hide"><fo:bookmark-title>8. Binding models and views (section unstarted)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_testing_section_unstarted" starting-state="hide"><fo:bookmark-title>9. Testing (section unstarted)</fo:bookmark-title><fo:bookmark internal-destination="_full_stack_integration_testing" starting-state="hide"><fo:bookmark-title>9.1. Full-stack integration testing</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_isolated_unit_testing" starting-state="hide"><fo:bookmark-title>9.2. Isolated unit testing</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_the_javascript_language_section_unstarted" starting-state="hide"><fo:bookmark-title>10. The JavaScript language (section unstarted)</fo:bookmark-title><fo:bookmark internal-destination="_model_attribute_types_and_serialization" starting-state="hide"><fo:bookmark-title>10.1. Model attribute types and serialization</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_context_binding_js_literal_this_literal" starting-state="hide"><fo:bookmark-title>10.2. Context binding (JS this)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_coffeescript_with_backbone_js" starting-state="hide"><fo:bookmark-title>10.3. CoffeeScript with Backbone.js</fo:bookmark-title></fo:bookmark></fo:bookmark><fo:bookmark internal-destination="_security_stub" starting-state="hide"><fo:bookmark-title>11. Security (stub)</fo:bookmark-title><fo:bookmark internal-destination="_xss_with_json_bootstrapping_stub" starting-state="hide"><fo:bookmark-title>11.1. XSS with JSON bootstrapping (stub)</fo:bookmark-title></fo:bookmark><fo:bookmark internal-destination="_xss_in_html_templates_stub" starting-state="hide"><fo:bookmark-title>11.2. XSS in HTML templates (stub)</fo:bookmark-title></fo:bookmark></fo:bookmark></fo:bookmark-tree><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="idp4440336"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_preface_section_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_getting_up_to_speed_section_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_backbone_js_online_resources"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_javascript_online_resources_and_books"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_introduction_section_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_why_use_backbone_js"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_when_not_to_use_backbone_js"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_why_not_sproutcore_cappuccino_knockout_js_spine_etc"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_organization"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_backbone_js_and_mvc"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_what_goes_where"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_namespacing_your_application_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_rails_integration"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_organizing_your_backbone_js_code_in_a_rails_app"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_rails_3_0_and_prior"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_a_note_on_jammit_and_a_jst_naming_gotcha"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_rails_3_1"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_converting_your_rails_models_to_backbone_js_friendly_json_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_converting_an_existing_page_view_area_to_use_backbone_js_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_automatically_using_the_rails_authentication_token"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_views_and_templates"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_view_explanation_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_templating_strategy_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_view_helpers_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_form_helpers_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_event_binding_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_cleaning_up_understanding_binding_and_unbinding_in_progress"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_swapping_router_in_progress"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_composite_views_in_progress"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_how_to_use_multiple_views_on_the_same_model_collection_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_internationalization_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_models_and_collections"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_naming_conventions_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_nested_resources_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_model_associations"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_belongs_to_associations"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_has_many_associations"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_scopes_and_filters"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_sorting"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_client_server_duplicated_business_logic_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_validations_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_synchronizing_between_clients_chapter_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_binding_models_and_views_section_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_testing_section_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_full_stack_integration_testing"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_isolated_unit_testing"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_the_javascript_language_section_unstarted"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_model_attribute_types_and_serialization"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_context_binding_js_literal_this_literal"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_coffeescript_with_backbone_js"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_security_stub"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_xss_with_json_bootstrapping_stub"/><fox:destination xmlns:fox="http://xmlgraphics.apache.org/fop/extensions" internal-destination="_xss_in_html_templates_stub"/><fo:page-sequence xmlns:axf="http://www.antennahouse.com/names/XSL/Extensions" hyphenate="false" master-reference="body" language="en" format="1" initial-page-number="1" force-page-count="no-force" hyphenation-character="-" hyphenation-push-character-count="2" hyphenation-remain-character-count="2"><fo:static-content flow-name="xsl-region-before-first"><fo:block font-family="serif,Symbol,ZapfDingbats" margin-left="0pt"><fo:table table-layout="fixed" width="100%" border-bottom-width="0.5pt" border-bottom-style="solid" border-bottom-color="black"><fo:table-column column-number="1" column-width="proportional-column-width(1)"/><fo:table-column column-number="2" column-width="proportional-column-width(1)"/><fo:table-column column-number="3" column-width="proportional-column-width(1)"/><fo:table-body><fo:table-row block-progression-dimension.minimum="14pt"><fo:table-cell text-align="start" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="center" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="right" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell></fo:table-row></fo:table-body></fo:table></fo:block></fo:static-content><fo:static-content flow-name="xsl-region-before-odd"><fo:block font-family="serif,Symbol,ZapfDingbats" margin-left="0pt"><fo:table table-layout="fixed" width="100%" border-bottom-width="0.5pt" border-bottom-style="solid" border-bottom-color="black"><fo:table-column column-number="1" column-width="proportional-column-width(1)"/><fo:table-column column-number="2" column-width="proportional-column-width(1)"/><fo:table-column column-number="3" column-width="proportional-column-width(1)"/><fo:table-body><fo:table-row block-progression-dimension.minimum="14pt"><fo:table-cell text-align="start" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="center" display-align="before" relative-align="baseline"><fo:block><fo:block>Backbone.js on Rails</fo:block></fo:block></fo:table-cell><fo:table-cell text-align="right" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell></fo:table-row></fo:table-body></fo:table></fo:block></fo:static-content><fo:static-content flow-name="xsl-region-before-even"><fo:block font-family="serif,Symbol,ZapfDingbats" margin-left="0pt"><fo:table table-layout="fixed" width="100%" border-bottom-width="0.5pt" border-bottom-style="solid" border-bottom-color="black"><fo:table-column column-number="1" column-width="proportional-column-width(1)"/><fo:table-column column-number="2" column-width="proportional-column-width(1)"/><fo:table-column column-number="3" column-width="proportional-column-width(1)"/><fo:table-body><fo:table-row block-progression-dimension.minimum="14pt"><fo:table-cell text-align="start" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="center" display-align="before" relative-align="baseline"><fo:block><fo:block>Backbone.js on Rails</fo:block></fo:block></fo:table-cell><fo:table-cell text-align="right" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell></fo:table-row></fo:table-body></fo:table></fo:block></fo:static-content><fo:static-content flow-name="xsl-region-before-blank"><fo:block font-family="serif,Symbol,ZapfDingbats" margin-left="0pt"><fo:table table-layout="fixed" width="100%" border-bottom-width="0.5pt" border-bottom-style="solid" border-bottom-color="black"><fo:table-column column-number="1" column-width="proportional-column-width(1)"/><fo:table-column column-number="2" column-width="proportional-column-width(1)"/><fo:table-column column-number="3" column-width="proportional-column-width(1)"/><fo:table-body><fo:table-row block-progression-dimension.minimum="14pt"><fo:table-cell text-align="start" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="center" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="right" display-align="before" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell></fo:table-row></fo:table-body></fo:table></fo:block></fo:static-content><fo:static-content flow-name="xsl-footnote-separator"><fo:block><fo:leader color="black" leader-pattern="rule" leader-length="1in"/></fo:block></fo:static-content><fo:static-content flow-name="xsl-region-after-first"><fo:block font-family="serif,Symbol,ZapfDingbats" margin-left="0pt"><fo:table table-layout="fixed" width="100%" border-top-width="0.5pt" border-top-style="solid" border-top-color="black"><fo:table-column column-number="1" column-width="proportional-column-width(1)"/><fo:table-column column-number="2" column-width="proportional-column-width(1)"/><fo:table-column column-number="3" column-width="proportional-column-width(1)"/><fo:table-body><fo:table-row block-progression-dimension.minimum="14pt"><fo:table-cell text-align="start" display-align="after" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="center" display-align="after" relative-align="baseline"><fo:block><fo:block><fo:page-number/></fo:block></fo:block></fo:table-cell><fo:table-cell text-align="end" display-align="after" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell></fo:table-row></fo:table-body></fo:table></fo:block></fo:static-content><fo:static-content flow-name="xsl-region-after-odd"><fo:block font-family="serif,Symbol,ZapfDingbats" margin-left="0pt"><fo:table table-layout="fixed" width="100%" border-top-width="0.5pt" border-top-style="solid" border-top-color="black"><fo:table-column column-number="1" column-width="proportional-column-width(1)"/><fo:table-column column-number="2" column-width="proportional-column-width(1)"/><fo:table-column column-number="3" column-width="proportional-column-width(1)"/><fo:table-body><fo:table-row block-progression-dimension.minimum="14pt"><fo:table-cell text-align="start" display-align="after" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="center" display-align="after" relative-align="baseline"><fo:block><fo:block><fo:page-number/></fo:block></fo:block></fo:table-cell><fo:table-cell text-align="end" display-align="after" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell></fo:table-row></fo:table-body></fo:table></fo:block></fo:static-content><fo:static-content flow-name="xsl-region-after-even"><fo:block font-family="serif,Symbol,ZapfDingbats" margin-left="0pt"><fo:table table-layout="fixed" width="100%" border-top-width="0.5pt" border-top-style="solid" border-top-color="black"><fo:table-column column-number="1" column-width="proportional-column-width(1)"/><fo:table-column column-number="2" column-width="proportional-column-width(1)"/><fo:table-column column-number="3" column-width="proportional-column-width(1)"/><fo:table-body><fo:table-row block-progression-dimension.minimum="14pt"><fo:table-cell text-align="start" display-align="after" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="center" display-align="after" relative-align="baseline"><fo:block><fo:block><fo:page-number/></fo:block></fo:block></fo:table-cell><fo:table-cell text-align="end" display-align="after" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell></fo:table-row></fo:table-body></fo:table></fo:block></fo:static-content><fo:static-content flow-name="xsl-region-after-blank"><fo:block font-family="serif,Symbol,ZapfDingbats" margin-left="0pt"><fo:table table-layout="fixed" width="100%" border-top-width="0.5pt" border-top-style="solid" border-top-color="black"><fo:table-column column-number="1" column-width="proportional-column-width(1)"/><fo:table-column column-number="2" column-width="proportional-column-width(1)"/><fo:table-column column-number="3" column-width="proportional-column-width(1)"/><fo:table-body><fo:table-row block-progression-dimension.minimum="14pt"><fo:table-cell text-align="start" display-align="after" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell><fo:table-cell text-align="center" display-align="after" relative-align="baseline"><fo:block><fo:block><fo:page-number/></fo:block></fo:block></fo:table-cell><fo:table-cell text-align="end" display-align="after" relative-align="baseline"><fo:block><fo:block/></fo:block></fo:table-cell></fo:table-row></fo:table-body></fo:table></fo:block></fo:static-content><fo:flow flow-name="xsl-region-body" start-indent="1pc" end-indent="0pt"><fo:block id="idp4440336"><fo:block font-family="sans-serif,Symbol,ZapfDingbats"><fo:block start-indent="0pt" text-align="center"><fo:block keep-with-next.within-column="always" font-size="24.8832pt" font-weight="bold"><fo:block keep-with-next.within-column="always" space-before.optimum="12pt" space-before.minimum="12pt * 0.8" space-before.maximum="12pt * 1.2" hyphenate="false" text-align="center" start-indent="0pt" hyphenation-character="-" hyphenation-push-character-count="2" hyphenation-remain-character-count="2">Backbone.js on Rails</fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="toc...idp4440336" space-before.minimum="0.5em" space-before.optimum="1em" space-before.maximum="2em" space-after.minimum="0.5em" space-after.optimum="1em" space-after.maximum="2em"><fo:block><fo:block><fo:block space-before.minimum="1em" space-before.optimum="1.5em" space-before.maximum="2em" space-after="0.5em" margin-left="0pt" start-indent="0pt" font-size="17.28pt" font-weight="bold" font-family="sans-serif,Symbol,ZapfDingbats">Table of Contents</fo:block></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_preface_section_unstarted">1. Preface (section unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_preface_section_unstarted"><fo:page-number-citation ref-id="_preface_section_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_getting_up_to_speed_section_unstarted">2. Getting up to speed (section unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_getting_up_to_speed_section_unstarted"><fo:page-number-citation ref-id="_getting_up_to_speed_section_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._getting_up_to_speed_section_unstarted" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_backbone_js_online_resources">2.1. Backbone.js online resources</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_backbone_js_online_resources"><fo:page-number-citation ref-id="_backbone_js_online_resources"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_javascript_online_resources_and_books">2.2. JavaScript online resources and books</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_javascript_online_resources_and_books"><fo:page-number-citation ref-id="_javascript_online_resources_and_books"/></fo:basic-link></fo:inline></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_introduction_section_unstarted">3. Introduction (section unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_introduction_section_unstarted"><fo:page-number-citation ref-id="_introduction_section_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._introduction_section_unstarted" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_why_use_backbone_js">3.1. Why use Backbone.js</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_why_use_backbone_js"><fo:page-number-citation ref-id="_why_use_backbone_js"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_when_not_to_use_backbone_js">3.2. When not to use Backbone.js</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_when_not_to_use_backbone_js"><fo:page-number-citation ref-id="_when_not_to_use_backbone_js"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_why_not_sproutcore_cappuccino_knockout_js_spine_etc">3.3. Why not SproutCore, Cappuccino, Knockout.js, Spine, etc.</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_why_not_sproutcore_cappuccino_knockout_js_spine_etc"><fo:page-number-citation ref-id="_why_not_sproutcore_cappuccino_knockout_js_spine_etc"/></fo:basic-link></fo:inline></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_organization">4. Organization</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_organization"><fo:page-number-citation ref-id="_organization"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._organization" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_backbone_js_and_mvc">4.1. Backbone.js and MVC</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_backbone_js_and_mvc"><fo:page-number-citation ref-id="_backbone_js_and_mvc"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_what_goes_where">4.2. What Goes Where</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_what_goes_where"><fo:page-number-citation ref-id="_what_goes_where"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_namespacing_your_application_chapter_unstarted">4.3. Namespacing your application (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_namespacing_your_application_chapter_unstarted"><fo:page-number-citation ref-id="_namespacing_your_application_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_rails_integration">5. Rails Integration</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_rails_integration"><fo:page-number-citation ref-id="_rails_integration"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._rails_integration" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_organizing_your_backbone_js_code_in_a_rails_app">5.1. Organizing your Backbone.js code in a Rails app</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_organizing_your_backbone_js_code_in_a_rails_app"><fo:page-number-citation ref-id="_organizing_your_backbone_js_code_in_a_rails_app"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_rails_3_0_and_prior">5.2. Rails 3.0 and prior</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_rails_3_0_and_prior"><fo:page-number-citation ref-id="_rails_3_0_and_prior"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_rails_3_1">5.3. Rails 3.1</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_rails_3_1"><fo:page-number-citation ref-id="_rails_3_1"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_converting_your_rails_models_to_backbone_js_friendly_json_chapter_unstarted">5.4. Converting your Rails models to Backbone.js-friendly JSON (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_converting_your_rails_models_to_backbone_js_friendly_json_chapter_unstarted"><fo:page-number-citation ref-id="_converting_your_rails_models_to_backbone_js_friendly_json_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_converting_an_existing_page_view_area_to_use_backbone_js_chapter_unstarted">5.5. Converting an existing page/view area to use Backbone.js (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_converting_an_existing_page_view_area_to_use_backbone_js_chapter_unstarted"><fo:page-number-citation ref-id="_converting_an_existing_page_view_area_to_use_backbone_js_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_automatically_using_the_rails_authentication_token">5.6. Automatically using the Rails authentication token</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_automatically_using_the_rails_authentication_token"><fo:page-number-citation ref-id="_automatically_using_the_rails_authentication_token"/></fo:basic-link></fo:inline></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_views_and_templates">6. Views and Templates</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_views_and_templates"><fo:page-number-citation ref-id="_views_and_templates"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._views_and_templates" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_view_explanation_chapter_unstarted">6.1. View explanation (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_view_explanation_chapter_unstarted"><fo:page-number-citation ref-id="_view_explanation_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_templating_strategy_chapter_unstarted">6.2. Templating strategy (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_templating_strategy_chapter_unstarted"><fo:page-number-citation ref-id="_templating_strategy_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_view_helpers_chapter_unstarted">6.3. View helpers (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_view_helpers_chapter_unstarted"><fo:page-number-citation ref-id="_view_helpers_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_form_helpers_chapter_unstarted">6.4. Form helpers (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_form_helpers_chapter_unstarted"><fo:page-number-citation ref-id="_form_helpers_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_event_binding_chapter_unstarted">6.5. Event binding (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_event_binding_chapter_unstarted"><fo:page-number-citation ref-id="_event_binding_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_cleaning_up_understanding_binding_and_unbinding_in_progress">6.6. Cleaning up: understanding binding and unbinding (in progress)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_cleaning_up_understanding_binding_and_unbinding_in_progress"><fo:page-number-citation ref-id="_cleaning_up_understanding_binding_and_unbinding_in_progress"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_swapping_router_in_progress">6.7. Swapping router (in progress)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_swapping_router_in_progress"><fo:page-number-citation ref-id="_swapping_router_in_progress"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_composite_views_in_progress">6.8. Composite views (in progress)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_composite_views_in_progress"><fo:page-number-citation ref-id="_composite_views_in_progress"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_how_to_use_multiple_views_on_the_same_model_collection_chapter_unstarted">6.9. How to use multiple views on the same model/collection (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_how_to_use_multiple_views_on_the_same_model_collection_chapter_unstarted"><fo:page-number-citation ref-id="_how_to_use_multiple_views_on_the_same_model_collection_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_internationalization_chapter_unstarted">6.10. Internationalization (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_internationalization_chapter_unstarted"><fo:page-number-citation ref-id="_internationalization_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_models_and_collections">7. Models and collections</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_models_and_collections"><fo:page-number-citation ref-id="_models_and_collections"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._models_and_collections" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_naming_conventions_chapter_unstarted">7.1. Naming conventions (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_naming_conventions_chapter_unstarted"><fo:page-number-citation ref-id="_naming_conventions_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_nested_resources_chapter_unstarted">7.2. Nested resources (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_nested_resources_chapter_unstarted"><fo:page-number-citation ref-id="_nested_resources_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_model_associations">7.3. Model associations</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_model_associations"><fo:page-number-citation ref-id="_model_associations"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_scopes_and_filters">7.4. Scopes and filters</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_scopes_and_filters"><fo:page-number-citation ref-id="_scopes_and_filters"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_sorting">7.5. Sorting</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_sorting"><fo:page-number-citation ref-id="_sorting"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_client_server_duplicated_business_logic_chapter_unstarted">7.6. Client/Server duplicated business logic (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_client_server_duplicated_business_logic_chapter_unstarted"><fo:page-number-citation ref-id="_client_server_duplicated_business_logic_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_validations_chapter_unstarted">7.7. Validations (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_validations_chapter_unstarted"><fo:page-number-citation ref-id="_validations_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_synchronizing_between_clients_chapter_unstarted">7.8. Synchronizing between clients (chapter unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_synchronizing_between_clients_chapter_unstarted"><fo:page-number-citation ref-id="_synchronizing_between_clients_chapter_unstarted"/></fo:basic-link></fo:inline></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_binding_models_and_views_section_unstarted">8. Binding models and views (section unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_binding_models_and_views_section_unstarted"><fo:page-number-citation ref-id="_binding_models_and_views_section_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_testing_section_unstarted">9. Testing (section unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_testing_section_unstarted"><fo:page-number-citation ref-id="_testing_section_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._testing_section_unstarted" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_full_stack_integration_testing">9.1. Full-stack integration testing</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_full_stack_integration_testing"><fo:page-number-citation ref-id="_full_stack_integration_testing"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_isolated_unit_testing">9.2. Isolated unit testing</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_isolated_unit_testing"><fo:page-number-citation ref-id="_isolated_unit_testing"/></fo:basic-link></fo:inline></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_the_javascript_language_section_unstarted">10. The JavaScript language (section unstarted)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_the_javascript_language_section_unstarted"><fo:page-number-citation ref-id="_the_javascript_language_section_unstarted"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._the_javascript_language_section_unstarted" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_model_attribute_types_and_serialization">10.1. Model attribute types and serialization</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_model_attribute_types_and_serialization"><fo:page-number-citation ref-id="_model_attribute_types_and_serialization"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_context_binding_js_literal_this_literal">10.2. Context binding (JS <fo:inline font-size="10pt" font-family="monospace">this</fo:inline>)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_context_binding_js_literal_this_literal"><fo:page-number-citation ref-id="_context_binding_js_literal_this_literal"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_coffeescript_with_backbone_js">10.3. CoffeeScript with Backbone.js</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_coffeescript_with_backbone_js"><fo:page-number-citation ref-id="_coffeescript_with_backbone_js"/></fo:basic-link></fo:inline></fo:block></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_security_stub">11. Security (stub)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_security_stub"><fo:page-number-citation ref-id="_security_stub"/></fo:basic-link></fo:inline></fo:block><fo:block id="toc.idp4440336._security_stub" margin-left="24pt"><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_xss_with_json_bootstrapping_stub">11.1. XSS with JSON bootstrapping (stub)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_xss_with_json_bootstrapping_stub"><fo:page-number-citation ref-id="_xss_with_json_bootstrapping_stub"/></fo:basic-link></fo:inline></fo:block><fo:block text-align-last="justify" text-align="start" end-indent="24pt" last-line-end-indent="-24pt"><fo:inline keep-with-next.within-line="always"><fo:basic-link internal-destination="_xss_in_html_templates_stub">11.2. XSS in HTML templates (stub)</fo:basic-link></fo:inline><fo:inline keep-together.within-line="always"> <fo:leader leader-pattern="dots" leader-pattern-width="3pt" leader-alignment="reference-area" keep-with-next.within-line="always"/> <fo:basic-link internal-destination="_xss_in_html_templates_stub"><fo:page-number-citation ref-id="_xss_in_html_templates_stub"/></fo:basic-link></fo:inline></fo:block></fo:block></fo:block><fo:block id="_preface_section_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Preface (section unstarted)</fo:marker><fo:block font-size="24.8832pt">1. Preface (section unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_getting_up_to_speed_section_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Getting up to speed (section unstarted)</fo:marker><fo:block font-size="24.8832pt">2. Getting up to speed (section unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_backbone_js_online_resources"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Backbone.js online resources</fo:marker><fo:block font-size="20.736pt">2.1. Backbone.js online resources</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_javascript_online_resources_and_books"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">JavaScript online resources and books</fo:marker><fo:block font-size="20.736pt">2.2. JavaScript online resources and books</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_introduction_section_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Introduction (section unstarted)</fo:marker><fo:block font-size="24.8832pt">3. Introduction (section unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_why_use_backbone_js"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Why use Backbone.js</fo:marker><fo:block font-size="20.736pt">3.1. Why use Backbone.js</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_when_not_to_use_backbone_js"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">When not to use Backbone.js</fo:marker><fo:block font-size="20.736pt">3.2. When not to use Backbone.js</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_why_not_sproutcore_cappuccino_knockout_js_spine_etc"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Why not SproutCore, Cappuccino, Knockout.js, Spine, etc.</fo:marker><fo:block font-size="20.736pt">3.3. Why not SproutCore, Cappuccino, Knockout.js, Spine, etc.</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_organization"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Organization</fo:marker><fo:block font-size="24.8832pt">4. Organization</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_backbone_js_and_mvc"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Backbone.js and MVC</fo:marker><fo:block font-size="20.736pt">4.1. Backbone.js and MVC</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Model–View–Controller (MVC) is an architectural pattern used in many
applications to isolate "domain logic" (the application logic for the user)
from the user interface (input and presentation).</fo:block><fo:block id="idp4451664" space-before.minimum="0.5em" space-before.optimum="1em" space-before.maximum="2em" space-after.minimum="0.5em" space-after.optimum="1em" space-after.maximum="2em" keep-together.within-column="always"><fo:block font-weight="bold" font-size="14.4pt" hyphenate="false" space-after.minimum="0.4em" space-after.optimum="0.6em" space-after.maximum="0.8em" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" keep-with-next.within-column="always">Figure 1. Model-view-controller concept</fo:block><fo:block id="idp4452304"><fo:external-graphic src="url(image/MVCDiagram.png)" width="auto" height="auto" content-width="auto" content-height="auto"/></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">In the above diagram, a solid line represents a direct association, a dashed
line an indirect association (for example, via an observer).</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">As a user of Rails, you’re likely already familiar with the concept of MVC and
the benefits that the separation of concerns can give you. However, Rails
itself is not doing "traditional" MVC. A traditional MVC is event-based. This
means that the views trigger events which the controller figures out what to do
with. It can be argued that the requests generated by the browser are the
"events" in Rails, however, due to the single-threaded, request-response nature
of the web, the control flow between the different levels of MVC is much more
straight-forward.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Given that Javascript has events, and that much of the interactions between the
different components of Backbone.js in the browser are not limited to
request/response, programming with Backbone.js is in a lot of ways more like
working with a traditional MVC architecture.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">That being said, technically speaking, Backbone.js is <fo:inline font-style="italic">not</fo:inline> MVC, and this was
acknowledged by the creators of Backbone.js when they renamed Controllers to
Routers in version 0.5.0.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">So what is Backbone.js then if not MVC? Technically speaking, it’s just the
Models and the Views with a Router to handle flow between them. In Backbone.js
the views will handle many of the aspects that controllers would typically
handle, such as actually figuring out what to do next and what to render.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">While you could do it, the benefit of actually introducing a Controller in your
application would be limited, and the more pragmatic approach is to realize the
great organization that Backbone.js gives you is much better than what you had
before. The fact that it doesn’t have a nice name, or strict adherence to a
pattern, isn’t worth worrying about.</fo:block></fo:block><fo:block id="_what_goes_where"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">What Goes Where</fo:marker><fo:block font-size="20.736pt">4.2. What Goes Where</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Part of the initial learning curve of Backbone.js can be figuring out what goes
where, and mapping it to your expectations set by working with Rails. In Rails
we have Models, Views, Controllers, and Routers. In Backbone.js, we have
Models, Views, Templates, and Routers.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">The models in Backbone.js and Rails are analogous. Because it lacks
controllers, Backbone.js routers and views work together to pick up the
functionality provided by Rails controllers. Finally, in Rails, when we say
views, we actually mean templates. In Backbone.js, however, you have a
separation between the view and templates.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Once you introduce Backbone.js into your stack, you grow the layers in your
stack by four levels. This can be daunting at first, and frankly, at times it
can be difficult to keep everything going on in your application straight.
Ultimately, the additional organization and functionality of Backbone.js
outweighs the costs, so let’s break it down.</fo:block><fo:block font-weight="bold" font-size="14.4pt" hyphenate="false" space-after.minimum="0.4em" space-after.optimum="0.6em" space-after.maximum="0.8em" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" keep-with-next.within-column="always">Rails</fo:block><fo:list-block id="idp4462544" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" space-after.optimum="1em" space-after.minimum="0.8em" space-after.maximum="1.2em" provisional-label-separation="0.2em" provisional-distance-between-starts="1.0em"><fo:list-item id="idp4463792" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
Model
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4464560" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
Controller
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4465328" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
View
</fo:block></fo:block></fo:list-item-body></fo:list-item></fo:list-block><fo:block font-weight="bold" font-size="14.4pt" hyphenate="false" space-after.minimum="0.4em" space-after.optimum="0.6em" space-after.maximum="0.8em" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" keep-with-next.within-column="always">Backbone.js</fo:block><fo:list-block id="idp4466224" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" space-after.optimum="1em" space-after.minimum="0.8em" space-after.maximum="1.2em" provisional-label-separation="0.2em" provisional-distance-between-starts="1.0em"><fo:list-item id="idp4466736" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
Model
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4467504" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
Router
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4468272" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
View
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4469040" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
Template
</fo:block></fo:block></fo:list-item-body></fo:list-item></fo:list-block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">In a typical Rails and Backbone.js application, the initial interaction between
the layers will be as follows:</fo:block><fo:list-block id="idp4470544" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" space-after.optimum="1em" space-after.minimum="0.8em" space-after.maximum="1.2em" provisional-label-separation="0.2em" provisional-distance-between-starts="1.0em"><fo:list-item id="idp4470800" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
A request from a user comes in the <fo:inline font-weight="bold">Rails router</fo:inline> identifies what should
  handle the request based on the URL
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4472208" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
The <fo:inline font-weight="bold">Rails controller action</fo:inline> to handle the request is called, some initial
  processing may be performed
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4473648" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
The <fo:inline font-weight="bold">Rails view template</fo:inline> is rendered and returned to the user’s browser
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4474928" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
The <fo:inline font-weight="bold">Rails view template</fo:inline> will include <fo:inline font-weight="bold">Backbone.js initialization</fo:inline>, usually
  this is populating some <fo:inline font-weight="bold">Backbone models</fo:inline> with JSON data provided by the
 <fo:inline font-weight="bold">Rails view</fo:inline>
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4477744" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
The <fo:inline font-weight="bold">Backbone.js router</fo:inline> determines which of its methods should handle the
  display based on the URL
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4479184" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
The <fo:inline font-weight="bold">Backbone.js router</fo:inline> method calls that method, some initial processing
  may be performed, and one or more <fo:inline font-weight="bold">Backbone.js views</fo:inline> are rendered
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4481152" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
The <fo:inline font-weight="bold">Backbone.js view</fo:inline> reads <fo:inline font-weight="bold">templates</fo:inline> and uses <fo:inline font-weight="bold">Backbone.js</fo:inline> models to
  render itself onto the page
</fo:block></fo:block></fo:list-item-body></fo:list-item></fo:list-block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">At this point, the user will see a nice page in their browser and be able to
interact with it. The user interacting with elements on the page will trigger
actions to be taken at any level of the above sequence: <fo:inline font-weight="bold">Backbone.js model</fo:inline>,
<fo:inline font-weight="bold">Backbone.js views</fo:inline>, <fo:inline font-weight="bold">Backbone.js router</fo:inline>, or requests to the remote server.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Requests to the remote server may be any one of the following:</fo:block><fo:list-block id="idp4486208" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" space-after.optimum="1em" space-after.minimum="0.8em" space-after.maximum="1.2em" provisional-label-separation="0.2em" provisional-distance-between-starts="1.0em"><fo:list-item id="idp4486464" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
At the <fo:inline font-weight="bold">Backbone.js model</fo:inline> level, communicating with Rails via JSON.
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4487744" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
Normal Ajax requests, not using Backbone.js at all.
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4488512" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
Normal requests that don’t hit Backbone.js and trigger a full page reload.
</fo:block></fo:block></fo:list-item-body></fo:list-item></fo:list-block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Which of the above remote server interactions you use will depend upon the
desired result, and the type of user interface. This book should help you
understand which interaction you’ll want to choose for each portion of your
application.</fo:block></fo:block><fo:block id="_namespacing_your_application_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Namespacing your application (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">4.3. Namespacing your application (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_rails_integration"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Rails Integration</fo:marker><fo:block font-size="24.8832pt">5. Rails Integration</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_organizing_your_backbone_js_code_in_a_rails_app"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Organizing your Backbone.js code in a Rails app</fo:marker><fo:block font-size="20.736pt">5.1. Organizing your Backbone.js code in a Rails app</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">When using Backbone.js in a Rails app, you’ll have two kinds of
Backbone.js-related assets: classes, and templates.</fo:block></fo:block><fo:block id="_rails_3_0_and_prior"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Rails 3.0 and prior</fo:marker><fo:block font-size="20.736pt">5.2. Rails 3.0 and prior</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">With Rails 3.0 and prior, store your Backbone.js classes in
<fo:inline font-size="10pt" font-family="monospace">public/javascripts</fo:inline>:</fo:block><fo:block id="idp4495600" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">public/
  javascripts/
    jquery.js
    jquery-ui.js
    models/
      user.js
      todo.js
    routers/
      users_router.js
      todos_router.js
    views/
      users/
        users_index.js
        users_new.js
        users_edit.js
      todos/
        todos_index.js</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">If you are using templates, we prefer storing them in <fo:inline font-size="10pt" font-family="monospace">app/templates</fo:inline> to keep
them separated from the server views:</fo:block><fo:block id="idp4497312" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">app/
  views/
    pages/
      home.html.erb
      terms.html.erb
      privacy.html.erb
      about.html.erb
  templates/
    users/
      index.jst
      new.jst
      edit.jst
    todos/
      index.jst
      show.jst</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">On Rails 3.0 and prior apps, we use Jammit for packaging assets and
precompiling templates:</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:basic-link external-destination="url(http://documentcloud.github.com/jammit/)">http://documentcloud.github.com/jammit/</fo:basic-link><fo:block/>
<fo:basic-link external-destination="url(http://documentcloud.github.com/jammit/#jst)">http://documentcloud.github.com/jammit/#jst</fo:basic-link></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Jammit will make your templates available in a top-level JST object. For
example, to access the above todos/index.jst template, you would refer to it
as:</fo:block><fo:block id="idp4500608" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">JST['todos/index']</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Variables can be passed to the templates by passing a Hash to the template, as
shown below.</fo:block><fo:block id="idp4501952" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">JST['todos/index']({ model: this.model })</fo:block><fo:block id="_a_note_on_jammit_and_a_jst_naming_gotcha"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:block font-size="17.28pt">5.2.1. A note on Jammit and a JST naming gotcha</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">One issue with Jammit that we’ve encountered and worked around is that the JST
template path can change when adding new templates.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">When using Jammit, there is a slightly sticky issue as an app grows from one
template subdirectory to multiple template subdirectories.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Let’s say you place templates in app/templates. You work for a while on the
"Tasks" feature, placing templates under app/templates/tasks. So, window.JST
looks something like:</fo:block><fo:block id="idp4505712" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">JST['form']
JST['show']
JST['index']</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Now, you add another directory under app/templates, say app/templates/user.
Now, all JST references are prefixed with their parent directory name so they
are unambiguous:</fo:block><fo:block id="idp4507056" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">JST['tasks/form']
JST['tasks/show']
JST['tasks/index']
JST['users/new']
JST['users/show']
JST['users/index']</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">This breaks existing JST references. You can work around this issue by applying
the following monkeypatch to Jammit, in config/initializers/jammit.rb</fo:block><fo:block id="idp4508704" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">Jammit::Compressor.class_eval do
  private
  def find_base_path(path)
    File.expand_path(Rails.root.join('app','templates'))
  end
end</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">As applications are moving to Rails 3.1, they’re also moving to Sprockets for
the asset packager.  Until then, many apps are using Jammit for asset
packaging.  One issue with Jammit we’ve encountered and worked around is that
the JST template path can change when adding new templates.  We have an open
issue and workaround:</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:basic-link external-destination="url(https://github.com/documentcloud/jammit/issues/192)">https://github.com/documentcloud/jammit/issues/192</fo:basic-link></fo:block></fo:block></fo:block><fo:block id="_rails_3_1"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Rails 3.1</fo:marker><fo:block font-size="20.736pt">5.3. Rails 3.1</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Rails 3.1 introduces the asset pipeline:</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:basic-link external-destination="url(http://edgeguides.rubyonrails.org/asset_pipeline.html)">http://edgeguides.rubyonrails.org/asset_pipeline.html</fo:basic-link></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">which uses the Sprockets library for preprocessing and packaging assets:</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:basic-link external-destination="url(http://getsprockets.org/)">http://getsprockets.org/</fo:basic-link></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">To take advantage of the built-in asset pipeline, organize your Backbone.js
templates and classes in paths available to the asset pipeline.  Classes go in
<fo:inline font-size="10pt" font-family="monospace">app/assets/javascripts/</fo:inline>, and templates go alongside, in
<fo:inline font-size="10pt" font-family="monospace">app/assets/templates/</fo:inline>:</fo:block><fo:block id="idp4516768" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">app/
  assets/
    javascripts/
      jquery.js
      models/
        todo.js
      routers/
        todos_router.js
      views/
        todos/
          todos_index.js
    templates/
      todos/
        index.jst.ejs
        show.jst.ejs</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Using Sprockets' preprocessors, we can use templates as before.  Here, we’re
using the EJS template preprocessor to provide the same functionality as
Underscore.js' templates.  It compiles the <fo:inline font-size="10pt" font-family="monospace">*.jst</fo:inline> files and makes them
available on the client side via the <fo:inline font-size="10pt" font-family="monospace">window.JST</fo:inline> object. Identifying the
<fo:inline font-size="10pt" font-family="monospace">.ejs</fo:inline> extension and invoking EJS to compile the templates is managed by
Sprockets, and requires the <fo:inline font-size="10pt" font-family="monospace">ejs</fo:inline> gem to be included in the application
Gemfile.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">To make the <fo:inline font-size="10pt" font-family="monospace">*.jst</fo:inline> files available and create the <fo:inline font-size="10pt" font-family="monospace">window.JST</fo:inline> object, require
them in your application.js Sprockets manifest:</fo:block><fo:block id="idp4523472" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">//  other application requires
//= require_tree ../templates
//= require_tree .</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Underscore.js templates:
<fo:basic-link external-destination="url(http://documentcloud.github.com/underscore/#template)">http://documentcloud.github.com/underscore/#template</fo:basic-link></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">EJS gem:
<fo:basic-link external-destination="url(https://github.com/sstephenson/ruby-ejs)">https://github.com/sstephenson/ruby-ejs</fo:basic-link></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Sprockets support for EJS:
<fo:basic-link external-destination="url(https://github.com/sstephenson/sprockets/blob/master/lib/sprockets/ejs_template.rb)">https://github.com/sstephenson/sprockets/blob/master/lib/sprockets/ejs_template.rb</fo:basic-link></fo:block></fo:block><fo:block id="_converting_your_rails_models_to_backbone_js_friendly_json_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Converting your Rails models to Backbone.js-friendly JSON (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">5.4. Converting your Rails models to Backbone.js-friendly JSON (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_converting_an_existing_page_view_area_to_use_backbone_js_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Converting an existing page/view area to use Backbone.js (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">5.5. Converting an existing page/view area to use Backbone.js (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_automatically_using_the_rails_authentication_token"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Automatically using the Rails authentication token</fo:marker><fo:block font-size="20.736pt">5.6. Automatically using the Rails authentication token</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">When using Backbone.js in a Rails app, you will run into a conflict with the
Rails built in Cross Site Scripting (XSS) protection.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">When Rails XSS is enabled, each POST or PUT request to Rails should include a
special token which is verified to ensure that the request originated from a
user which is actually using the Rails app. In recent versions of Rails,
Backbone.js Ajax requests are no exception.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">To get around this, you have two options. Disable Rails XSS protection (not
recommended), or make Backbone.js play nicely with Rails XSS.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">To make Backbone.js play nicely with Rails XSS you can monkeypatch Backbone.js
to include the Rails XSS token in any requests it makes.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">The following is one such script.</fo:block><fo:block id="idp4533984" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">//
// With additions by Maciej Adwent http://github.com/Maciek416
// If token name and value are not supplied, this code Requires jQuery
//
// Adapted from:
// http://www.ngauthier.com/2011/02/backbone-and-rails-forgery-protection.html
// Nick Gauthier @ngauthier
//

var BackboneRailsAuthTokenAdapter = {

  //
  // Given an instance of Backbone, route its sync() function so that
  // it executes through this one first, which mixes in the CSRF
  // authenticity token that Rails 3 needs to protect requests from
  // forgery. Optionally, the token's name and value can be supplied
  // by the caller.
  //
  fixSync: function(Backbone, paramName /*optional*/, paramValue /*optional*/){

    if(typeof(paramName)=='string' &amp;&amp; typeof(paramValue)=='string'){
      // Use paramName and paramValue as supplied
    } else {
      // Assume we've rendered meta tags with erb
      paramName = $("meta[name='csrf-param']").attr('content');
      paramValue = $("meta[name='csrf-token']").attr('content');
    }

    // alias away the sync method
    Backbone._sync = Backbone.sync;

    // define a new sync method
    Backbone.sync = function(method, model, success, error) {

      // only need a token for non-get requests
      if (method == 'create' || method == 'update' || method == 'delete') {

        // grab the token from the meta tag rails embeds
        var auth_options = {};
        auth_options[paramName] = paramValue;

        // set it as a model attribute without triggering events
        model.set(auth_options, {silent: true});
      }

      // proxy the call to the old sync method
      return Backbone._sync(method, model, success, error);
    };
  },


  // change Backbone's sync function back to the original one
  restoreSync: function(Backbone){
    Backbone.sync = Backbone._sync;
  }
};</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">The above patch depends on jQuery, and should be included in your after jQuery
and Backbone.js are loaded. Using Jammit, you’d list it below the backbone.js
file.</fo:block></fo:block></fo:block><fo:block id="_views_and_templates"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Views and Templates</fo:marker><fo:block font-size="24.8832pt">6. Views and Templates</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_view_explanation_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">View explanation (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">6.1. View explanation (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_templating_strategy_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Templating strategy (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">6.2. Templating strategy (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_view_helpers_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">View helpers (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">6.3. View helpers (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_form_helpers_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Form helpers (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">6.4. Form helpers (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_event_binding_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Event binding (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">6.5. Event binding (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_cleaning_up_understanding_binding_and_unbinding_in_progress"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Cleaning up: understanding binding and unbinding (in progress)</fo:marker><fo:block font-size="20.736pt">6.6. Cleaning up: understanding binding and unbinding (in progress)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Imagine you’re writing a todo app.  Consider two views: an index view which
contains all the tasks, and a detail view that shows detail on one task.  The
interface switches between the two views, and both views can modify existing
tasks (say, to indicate that the task is complete or incomplete).</fo:block><fo:block id="idp4543904" space-before.minimum="0.5em" space-before.optimum="1em" space-before.maximum="2em" space-after.minimum="0.5em" space-after.optimum="1em" space-after.maximum="2em" keep-together.within-column="always"><fo:block font-weight="bold" font-size="14.4pt" hyphenate="false" space-after.minimum="0.4em" space-after.optimum="0.6em" space-after.maximum="0.8em" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" keep-with-next.within-column="always">Figure 2. Tasks index view</fo:block><fo:block id="idp4544640"><fo:external-graphic src="url(views_and_templates/tasks-index.png)" width="auto" height="auto" content-width="auto" content-height="auto"/></fo:block></fo:block><fo:block id="idp4546528" space-before.minimum="0.5em" space-before.optimum="1em" space-before.maximum="2em" space-after.minimum="0.5em" space-after.optimum="1em" space-after.maximum="2em" keep-together.within-column="always"><fo:block font-weight="bold" font-size="14.4pt" hyphenate="false" space-after.minimum="0.4em" space-after.optimum="0.6em" space-after.maximum="0.8em" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" keep-with-next.within-column="always">Figure 3. Tasks detail view</fo:block><fo:block id="idp4547264"><fo:external-graphic src="url(views_and_templates/tasks-detail.png)" width="auto" height="auto" content-width="auto" content-height="auto"/></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">The view classes look something like this:</fo:block><fo:block id="idp4549536" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var TasksIndex = Backbone.View.extend({
  template: JST['tasks/tasks_index'],
  tagName: 'section',
  id: 'tasks',

  initialize: function() {
    this.tasks = this.options.tasks;

    _.bindAll(this, "render");
    TaskApp.tasks.bind("change", this.render);
    TaskApp.tasks.bind("add", this.render);
  },

  render: function() {
    $(this.el).html(this.template({tasks: this.tasks}));
  }
});</fo:block><fo:block id="idp4551504" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var TaskDetail = Backbone.View.extend({
  template: JST['tasks/tasks_detail'],
  tagName: 'section',
  id: 'task',

  events: {
    "click .comments .form-inputs button": "createComment"
  },

  initialize: function() {
    this.model = this.options.model;

    _.bindAll(this, "render");

    this.model.bind("change", this.render);
    this.model.comments.bind("change", this.render);
    this.model.comments.bind("add", this.render);
  },

  render: function() {
    $(this.el).html(this.template({task: this.model}));
  },

  createComment: function() {
    var comment = new Comment({ text: this.$('.new-comment-input').val() });
    this.$('.new-comment-input').val('');
    this.model.comments.create(comment);
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Each task on the index page links to the detail view for itself.  When a user
follows one of these links and navigates from the index page to the detail
page, then interacts with the detail view to change a model, the <fo:inline font-size="10pt" font-family="monospace">change</fo:inline> event
on the <fo:inline font-size="10pt" font-family="monospace">TaskApp.tasks</fo:inline> collection is fired.  One consequence of this is that
the index view, which is still bound and observing the <fo:inline font-size="10pt" font-family="monospace">change</fo:inline> event, will
re-render itself.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">This is both a functional bug and a memory leak: not only will the index view
re-render and disrupt the detail display, but navigating back and forth between
the views without disposing of the previous view will keep creating and binding
more views.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">The solution is to make sure you unbind and remove views when you leave them.
Our approach to this is to use a convention in <fo:inline font-size="10pt" font-family="monospace">Router</fo:inline> instances, and reuse
this as a <fo:inline font-size="10pt" font-family="monospace">Router</fo:inline> subclass, <fo:inline font-size="10pt" font-family="monospace">SwappingRouter</fo:inline>.</fo:block></fo:block><fo:block id="_swapping_router_in_progress"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Swapping router (in progress)</fo:marker><fo:block font-size="20.736pt">6.7. Swapping router (in progress)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">When switching from one view to another, we should clean up the previous view.
Let’s augument our view to include the ability to clean itself up:</fo:block><fo:block id="idp4560992" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var MyView = Backbone.View.extend({
  // ...

  leave: function() {
    this.unbind();
    this.remove();
  },

  // ...
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">The <fo:inline font-size="10pt" font-family="monospace">unbind()</fo:inline> and <fo:inline font-size="10pt" font-family="monospace">remove()</fo:inline> functions are provided by <fo:inline font-size="10pt" font-family="monospace">Backbone.Events</fo:inline> and
<fo:inline font-size="10pt" font-family="monospace">Backbone.View</fo:inline>.  <fo:inline font-size="10pt" font-family="monospace">unbind()</fo:inline> will remove all callbacks registered on the view,
and <fo:inline font-size="10pt" font-family="monospace">remove()</fo:inline> will remove the view’s element from the DOM.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">In simple cases, we replace one full page view with another full page (less any
shared layout).  We introduce a convention that all actions underneath one
<fo:inline font-size="10pt" font-family="monospace">Router</fo:inline> share the same root element, and define it as <fo:inline font-size="10pt" font-family="monospace">el</fo:inline> on the router.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Now, a <fo:inline font-size="10pt" font-family="monospace">SwappingRouter</fo:inline> can take advantage of the <fo:inline font-size="10pt" font-family="monospace">leave()</fo:inline> function, and clean
up any existing views before swapping to a new one.  It swaps into a new view by
rendering that view into its own <fo:inline font-size="10pt" font-family="monospace">el</fo:inline>:</fo:block><fo:block id="idp4570960" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">SwappingRouter = function(options) {
  Backbone.Router.apply(this, [options]);
};

_.extend(SwappingRouter.prototype, Backbone.Router.prototype, {
  swap: function(newView) {
    if (this.currentView &amp;&amp; this.currentView.leave) {
      this.currentView.leave();
    }

    this.currentView = newView;
    this.currentView.render();
    $(this.el).empty().append(this.currentView.el);
  }
});

SwappingRouter.extend = Backbone.Router.extend;</fo:block></fo:block><fo:block id="_composite_views_in_progress"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Composite views (in progress)</fo:marker><fo:block font-size="20.736pt">6.8. Composite views (in progress)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">One of the first refactorings you find yourself doing in a non-trivial Backbone
app is splitting up large views into composable parts.  Let’s take another look
at the <fo:inline font-size="10pt" font-family="monospace">TaskDetail</fo:inline> source code from the beginning of this section:</fo:block><fo:block id="idp4574944" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var TaskDetail = Backbone.View.extend({
  template: JST['tasks/tasks_detail'],
  tagName: 'section',
  id: 'task',

  events: {
    "click .comments .form-inputs button": "createComment"
  },

  initialize: function() {
    this.model = this.options.model;

    _.bindAll(this, "render");

    this.model.bind("change", this.render);
    this.model.comments.bind("change", this.render);
    this.model.comments.bind("add", this.render);
  },

  render: function() {
    $(this.el).html(this.template({task: this.model}));
  },

  createComment: function() {
    var comment = new Comment({ text: this.$('.new-comment-input').val() });
    this.$('.new-comment-input').val('');
    this.model.comments.create(comment);
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">along with the template for that view:</fo:block><fo:block id="idp4577472" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;section class="task-details"&gt;
  &lt;input type="checkbox"&lt;%= task.isComplete() ? ' checked="checked"' : '' %&gt; /&gt;
  &lt;h2&gt;&lt;%= task.escape("title") %&gt;&lt;/h2&gt;
&lt;/section&gt;

&lt;section class="comments"&gt;
  &lt;ul&gt;
    &lt;% task.comments.each(function(comment) { %&gt;
      &lt;li&gt;
        &lt;h4&gt;&lt;%= comment.user.escape('name') %&gt;&lt;/h4&gt;
        &lt;p&gt;&lt;%= comment.escape('text') %&gt;&lt;/p&gt;
      &lt;/li&gt;
    &lt;% } %&gt;
  &lt;/ul&gt;

  &lt;div class="form-inputs"&gt;
    &lt;label for="new-comment-input"&gt;Add comment&lt;/label&gt;
    &lt;textarea id="new-comment-input" cols="30" rows="10"&gt;&lt;/textarea&gt;
    &lt;button&gt;Add Comment&lt;/button&gt;
  &lt;/div&gt;
&lt;/section&gt;</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">There are clearly several concerns going on here: rendering the task, rendering
the comments that folks have left, and rendering the form to create new
comments.  Let’s separate those concerns.  A first approach might be to just
break up the template files:</fo:block><fo:block id="idp4578880" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- tasks/show.jst --&gt;
&lt;section class="task-details"&gt;
  &lt;%= JST['tasks/details']({ task: task }) %&gt;
&lt;/section&gt;

&lt;section class="comments"&gt;
  &lt;%= JST['comments/list']({ task: task }) %&gt;
&lt;/section&gt;</fo:block><fo:block id="idp4580704" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- tasks/details.jst --&gt;
&lt;input type="checkbox"&lt;%= task.isComplete() ? ' checked="checked"' : '' %&gt; /&gt;
&lt;h2&gt;&lt;%= task.escape("title") %&gt;&lt;/h2&gt;</fo:block><fo:block id="idp4581840" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- comments/list.jst --&gt;
&lt;ul&gt;
  &lt;% task.comments.each(function(comment) { %&gt;
    &lt;%= JST['comments/item']({ comment: comment }) %&gt;
  &lt;% } %&gt;
&lt;/ul&gt;

&lt;%= JST['comments/new']() %&gt;</fo:block><fo:block id="idp4583088" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- comments/item.jst --&gt;
&lt;h4&gt;&lt;%= comment.user.escape('name') %&gt;&lt;/h4&gt;
&lt;p&gt;&lt;%= comment.escape('text') %&gt;&lt;/p&gt;</fo:block><fo:block id="idp4584320" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- comments/new.jst --&gt;
&lt;div class="form-inputs"&gt;
  &lt;label for="new-comment-input"&gt;Add comment&lt;/label&gt;
  &lt;textarea id="new-comment-input" cols="30" rows="10"&gt;&lt;/textarea&gt;
  &lt;button&gt;Add Comment&lt;/button&gt;
&lt;/div&gt;</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">But this is really only half the story.  The <fo:inline font-size="10pt" font-family="monospace">TaskDetail</fo:inline> view class still
handles multiple concerns: displaying the task, and creating comments.  Let’s
split that view class up, using the <fo:inline font-size="10pt" font-family="monospace">CompositeView</fo:inline> base class:</fo:block><fo:block id="idp4587600" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">CompositeView = function(options) {
  this.children = [];
  Backbone.View.apply(this, [options]);
};

_.extend(CompositeView.prototype, Backbone.View.prototype, {
  leave: function() {
    this.unbind();
    this.remove();
    this._leaveChildren();
    this._removeFromParent();
  },

  removeChild: function(view) {
    var index = this.children.indexOf(view);
    this.children.splice(index, 1);
  },

  renderChild: function(view) {
    view.render();
    this.children.push(view);
    view.parent = this;
  },

  appendChild: function(view) {
    this.renderChild(view);
    $(this.el).append(view.el);
  },

  renderChildInto: function(view, container) {
    this.renderChild(view);
    $(container).html('').append(view.el);
  },

  _leaveChildren: function() {
    var clonedChildren = this.children.slice(0);
    _.each(clonedChildren, function(view) {
      if (view.leave) {
        view.leave();
      }
    });
  },

  _removeFromParent: function() {
    if (this.parent) {
      this.parent.removeChild(this);
    }
  }
});

CompositeView.extend = Backbone.View.extend;</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Similar to the <fo:inline font-size="10pt" font-family="monospace">SwappingRouter</fo:inline>, the <fo:inline font-size="10pt" font-family="monospace">CompositeView</fo:inline> base class solves common
housekeeping problems by establishing a convention.  In this case, a parent view
maintains an array of its immediate children as <fo:inline font-size="10pt" font-family="monospace">this.children</fo:inline>.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">With this reference in place, a parent view’s <fo:inline font-size="10pt" font-family="monospace">leave()</fo:inline> method can invoke
<fo:inline font-size="10pt" font-family="monospace">leave()</fo:inline> on its children, ensuring that an entire tree of composed views is
cleaned up properly.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">For child views that can dismiss themselves, such as dialog boxes, children
maintain a back-reference at <fo:inline font-size="10pt" font-family="monospace">this.parent</fo:inline>.  This is used to reach up and call
<fo:inline font-size="10pt" font-family="monospace">this.parent.removeChild(this)</fo:inline> for these self-dismissing views.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Making use of <fo:inline font-size="10pt" font-family="monospace">CompositeView</fo:inline>, we split up the <fo:inline font-size="10pt" font-family="monospace">TaskDetail</fo:inline> view class:</fo:block><fo:block id="idp4596480" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var TaskDetail = Backbone.View.extend({
  tagName: 'section',
  id: 'task',

  initialize: function() {
    this.model = this.options.model;
    _.bindAll(this, "renderDetails");
    this.model.bind("change", this.renderDetails);
  },

  render: function() {
    this.renderLayout();
    this.renderDetail();
    this.renderCommentsList();
  },

  renderLayout: function() {
    $(this.el).html(JST['tasks/show']());
  },

  renderDetails: function() {
    var detailsMarkup = JST['tasks/details']({ task: this.model });
    this.$('.task-details').html(detailsMarkup);
  },

  renderCommentsList: function() {
    var commentsList = new CommentsList({ model: this.model });
    var commentsContainer = this.$('comments');
    this.renderChildInto(commentsList, commentsContainer);
  }
});</fo:block><fo:block id="idp4598384" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var CommentsList = CompositeView.extend({
  tagName: 'ul',

  initialize: function() {
    this.model = this.options.model;
    this.model.comments.bind("add", this.renderComments);
  },

  render: function() {
    this.renderLayout();
    this.renderComments();
    this.renderCommentForm();
  },

  renderLayout: function() {
    $(this.el).html(JST['comments/list']());
  },

  renderComments: function() {
    var commentsContainer = this.$('comments-list');
    commentsContainer.html('');

    this.model.comments.each(function(comment) {
      var commentMarkup = JST['comments/item']({ comment: comment });
      commentsContainer.append(commentMarkup);
    });
  },

  renderCommentForm: function() {
    var commentForm = new CommentForm({ model: this.model });
    var commentFormContainer = this.$('.new-comment-form');
    this.renderChildInto(commentForm, commentFormContainer);
  }
});</fo:block><fo:block id="idp4599440" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var CommentForm = CompositeView.extend({
  events: {
    "click button": "createComment"
  },

  initialize: function() {
    this.model = this.options.model;
  },

  render: function() {
    $(this.el).html(JST['comments/new']);
  },

  createComment: function() {
    var comment = new Comment({ text: $('.new-comment-input').val() });
    this.$('.new-comment-input').val('');
    this.model.comments.create(comment);
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Along with this, remove the <fo:inline font-size="10pt" font-family="monospace">&lt;%= JST(…) %&gt;</fo:inline> template nestings, allowing the
view classes to assemble the templates instead.  In this case, each template
contains placeholder elements that are used to wrap child views:</fo:block><fo:block id="idp4602688" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- tasks/show.jst --&gt;
&lt;section class="task-details"&gt;
&lt;/section&gt;

&lt;section class="comments"&gt;
&lt;/section&gt;</fo:block><fo:block id="idp4603808" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- tasks/details.jst --&gt;
&lt;input type="checkbox"&lt;%= task.isComplete() ? ' checked="checked"' : '' %&gt; /&gt;
&lt;h2&gt;&lt;%= task.escape("title") %&gt;&lt;/h2&gt;</fo:block><fo:block id="idp4605072" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- comments/list.jst --&gt;
&lt;ul class="comments-list"&gt;
&lt;/ul&gt;

&lt;section class="new-comment-form"&gt;
&lt;/section&gt;</fo:block><fo:block id="idp4606288" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- comments/item.jst --&gt;
&lt;h4&gt;&lt;%= comment.user.escape('name') %&gt;&lt;/h4&gt;
&lt;p&gt;&lt;%= comment.escape('text') %&gt;&lt;/p&gt;</fo:block><fo:block id="idp4607520" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;!-- comments/new.jst --&gt;
&lt;label for="new-comment-input"&gt;Add comment&lt;/label&gt;
&lt;textarea class="new-comment-input" cols="30" rows="10"&gt;&lt;/textarea&gt;
&lt;button&gt;Add Comment&lt;/button&gt;</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">There are several advantages to this approach:</fo:block><fo:list-block id="idp4609472" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em" space-after.optimum="1em" space-after.minimum="0.8em" space-after.maximum="1.2em" provisional-label-separation="0.2em" provisional-distance-between-starts="1.0em"><fo:list-item id="idp4609728" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
Split up like this, each view class has a smaller and more cohesive set of
  responsibilities.
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4610640" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
The comments view code, extracted and decoupled from the task view code, can
  now be reused on other domain objects with comments.
</fo:block></fo:block></fo:list-item-body></fo:list-item><fo:list-item id="idp4611680" space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em"><fo:list-item-label end-indent="label-end()"><fo:block>•</fo:block></fo:list-item-label><fo:list-item-body start-indent="body-start()"><fo:block><fo:block>
The task view performs better, since adding new comments or updating the task
  details will only re-render the pertinent section, instead of re-rendering the
  entire task + comments composite.
</fo:block></fo:block></fo:list-item-body></fo:list-item></fo:list-block></fo:block><fo:block id="_how_to_use_multiple_views_on_the_same_model_collection_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">How to use multiple views on the same model/collection (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">6.9. How to use multiple views on the same model/collection (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_internationalization_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Internationalization (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">6.10. Internationalization (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_models_and_collections"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Models and collections</fo:marker><fo:block font-size="24.8832pt">7. Models and collections</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_naming_conventions_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Naming conventions (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">7.1. Naming conventions (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_nested_resources_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Nested resources (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">7.2. Nested resources (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_model_associations"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Model associations</fo:marker><fo:block font-size="20.736pt">7.3. Model associations</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Backbone.js doesn’t prescribe a way to define associations between models, so
we need to get creative and use the power of JavaScript to set up associations
in a way that it’s usage is natural.</fo:block><fo:block id="_belongs_to_associations"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:block font-size="17.28pt">7.3.1. Belongs to associations</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Setting up a <fo:inline font-size="10pt" font-family="monospace">belongs_to</fo:inline> association in Backbone is a two step process. Let’s
discuss setting up the association that may occur between a task and a user.
The end result of the approach is a <fo:inline font-size="10pt" font-family="monospace">Task</fo:inline> instance having a property called
<fo:inline font-size="10pt" font-family="monospace">user</fo:inline> where we store the associated <fo:inline font-size="10pt" font-family="monospace">User</fo:inline> object.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">To set this up, let’s start by telling Rails to augment the task’s JSON
representation to also send over the associated user attributes:</fo:block><fo:block id="idp4624336" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">class Task &lt; ActiveRecord::Base
  belongs_to :user

  def as_json(options = {})
    super(include: { user: { only: [:name, :email] } })
  end
end</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">This means that when Backbone calls <fo:inline font-size="10pt" font-family="monospace">fetch()</fo:inline> for a <fo:inline font-size="10pt" font-family="monospace">Task</fo:inline> model, it will
include the name and email of the associated user nested within the task JSON
representation. Something like this:</fo:block><fo:block id="idp4627568" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">{
  "title": "Buy more Cheeseburgers",
  "due_date": "2011-03-04",
  "user": {
    "name": "Robert McGraffalon",
    "email": "bobby@themcgraffalons.com"
  }
}</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Now that we receive user data with the task’s JSON representation, let’s tell
our Backbone User model to store the User object. We do that on the task’s
initializer. Here’s a first cut at that:</fo:block><fo:block id="idp4629712" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var Task = Backbone.Model.extend({
  initialize: function() {
    this.user = new User(this.get('user'));
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">A couple of improvements to the above: You’ll soon realize that you will might
be setting the user outside of the initialize as well. Also, the initializer
should check whether there user data in the first place. To address the first
concern, let’s create a setter for the object. Backbone provides a handy
function called <fo:inline font-size="10pt" font-family="monospace">has</fo:inline> that returns whether the provided option is set for the
object:</fo:block><fo:block id="idp4632288" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var User = Backbone.Model.extend({
  initialize: function() {
    if (this.has('user')) {
      this.user = setUser(new User(this.get('user')));
    }
  },

  setUser: function(user) {
    this.user = user;
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">The final setup allows for a nice clean interface to a task’s user, by
accessing the task property fo the user instance.</fo:block><fo:block id="idp4634224" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var task = Task.fetch(1);
console.log(task.get('title') + ' is being worked on by ' + task.user.get('name'));</fo:block></fo:block><fo:block id="_has_many_associations"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:block font-size="17.28pt">7.3.2. Has many associations</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">You can take a similar approach to set up a <fo:inline font-size="10pt" font-family="monospace">has_many</fo:inline> association on the
client side models. This time, however, the object’s property will be a
Backbone collection.</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Following the example, say we need access to a user’s tasks. Let’s set up the
JSON representation on the Rails side first:</fo:block><fo:block id="idp4638448" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">class User &lt; ActiveRecord::Base
  has_many :tasks

  def as_json(options = {})
    super(include: { tasks: { only: [:body, :due_date] } })
  end
end</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Now, on the Backbone <fo:inline font-size="10pt" font-family="monospace">User</fo:inline> model’s initializer, let’s call the <fo:inline font-size="10pt" font-family="monospace">setTasks</fo:inline>
function:</fo:block><fo:block id="idp4641392" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var User = Backbone.Model.extend({
  initialize: function() {
    var tasks = new Tasks.reset(this.get('tasks'));
    this.setTasks(tasks);
  },

  setTasks: function(tasks) {
    this.tasks = tasks;
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Note that we are setting the relation to an instance of the <fo:inline font-size="10pt" font-family="monospace">Tasks</fo:inline> collection.</fo:block></fo:block></fo:block><fo:block id="_scopes_and_filters"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Scopes and filters</fo:marker><fo:block font-size="20.736pt">7.4. Scopes and filters</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">To filter a <fo:inline font-size="10pt" font-family="monospace">Backbone.Collection</fo:inline>, like with Rails named scopes, define
functions on your collections that filter by your criteria and return new
instances of the collection class. A first implementation might look like this:</fo:block><fo:block id="idp4646096" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var Tasks = Backbone.Collection.extend({
  model: Task,
  url: '/tasks',

  complete: function() {
    var filteredTasks = this.select(function(task) {
      return task.get('completed_at') !== null;
    });
    return new Tasks(filteredTasks);
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Ideally, the filter functions will reuse logic already defined in your model
class:</fo:block><fo:block id="idp4648496" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var Task = Backbone.Model.extend({
  isComplete: function() {
    return this.get('completed_at') !== null;
  }
});

var Tasks = Backbone.Collection.extend({
  model: Task,
  url: '/tasks',

  complete: function() {
    var filteredTasks = this.select(function(task) {
      return task.isComplete();
    });
    return new Tasks(filteredTasks);
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Going further, you can separate the two concerns here, and extract a <fo:inline font-size="10pt" font-family="monospace">filtered</fo:inline>
function:</fo:block><fo:block id="idp4651184" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var Task = Backbone.Model.extend({
  isComplete: function() {
    return this.get('completed_at') !== null;
  }
});

var Tasks = Backbone.Collection.extend({
  model: Task,
  url: '/tasks',

  complete: function() {
    return this.filtered(this.select(function(task) {
      return task.isComplete();
    }));
  },

  filtered: function(criteriaFunction) {
    return new Tasks(this.select(criteriaFunction));
  }
});</fo:block></fo:block><fo:block id="_sorting"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Sorting</fo:marker><fo:block font-size="20.736pt">7.5. Sorting</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">The simplest way to sort a <fo:inline font-size="10pt" font-family="monospace">Backbone.Collection</fo:inline> is to define a <fo:inline font-size="10pt" font-family="monospace">comparator</fo:inline>
function:</fo:block><fo:block id="idp4655680" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var Tasks = Backbone.Collection.extend({
  model: Task,
  url: '/tasks',

  comparator: function(task) {
    return task.dueDate;
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">If you’d like to provide more than one sort order on your collection, you can
use an approach similar to the <fo:inline font-size="10pt" font-family="monospace">filtered</fo:inline> function above, and return a new
<fo:inline font-size="10pt" font-family="monospace">Backbone.Collection</fo:inline> whose <fo:inline font-size="10pt" font-family="monospace">comparator</fo:inline> is overridden.  Call <fo:inline font-size="10pt" font-family="monospace">sort</fo:inline> to update
the ordering on the new collection:</fo:block><fo:block id="idp4660304" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var Tasks = Backbone.Collection.extend({
  model: Task,
  url: '/tasks',

  comparator: function(task) {
    return task.dueDate;
  },

  byCreatedAt: function() {
    var sortedCollection = new Tasks(this.models);
    sortedCollection.comparator = function(task) {
      return task.createdAt;
    };
    sortedCollection.sort();
    return sortedCollection;
  }
});</fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Similarly, you can extract the resuable concern to another function:</fo:block><fo:block id="idp4662752" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">var Tasks = Backbone.Collection.extend({
  model: Task,
  url: '/tasks',

  comparator: function(task) {
    return task.dueDate;
  },

  byCreatedAt: function() {
    return this.sortedBy(function(task) {
      return task.createdAt;
    });
  },

  byCompletedAt: function() {
    return this.sortedBy(function(task) {
      return task.createdAt;
    });
  },

  sortedBy: function(comparator) {
    var sortedCollection = new Tasks(this.models);
    sortedCollection.comparator = comparator;
    sortedCollection.sort();
    return sortedCollection;
  }
});</fo:block></fo:block><fo:block id="_client_server_duplicated_business_logic_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Client/Server duplicated business logic (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">7.6. Client/Server duplicated business logic (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_validations_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Validations (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">7.7. Validations (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_synchronizing_between_clients_chapter_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Synchronizing between clients (chapter unstarted)</fo:marker><fo:block font-size="20.736pt">7.8. Synchronizing between clients (chapter unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_binding_models_and_views_section_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Binding models and views (section unstarted)</fo:marker><fo:block font-size="24.8832pt">8. Binding models and views (section unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_testing_section_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Testing (section unstarted)</fo:marker><fo:block font-size="24.8832pt">9. Testing (section unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_full_stack_integration_testing"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Full-stack integration testing</fo:marker><fo:block font-size="20.736pt">9.1. Full-stack integration testing</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_isolated_unit_testing"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Isolated unit testing</fo:marker><fo:block font-size="20.736pt">9.2. Isolated unit testing</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_the_javascript_language_section_unstarted"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">The JavaScript language (section unstarted)</fo:marker><fo:block font-size="24.8832pt">10. The JavaScript language (section unstarted)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_model_attribute_types_and_serialization"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Model attribute types and serialization</fo:marker><fo:block font-size="20.736pt">10.1. Model attribute types and serialization</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_context_binding_js_literal_this_literal"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Context binding (JS <fo:inline font-size="10pt" font-family="monospace">this</fo:inline>)</fo:marker><fo:block font-size="20.736pt">10.2. Context binding (JS <fo:inline font-size="10pt" font-family="monospace">this</fo:inline>)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_coffeescript_with_backbone_js"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">CoffeeScript with Backbone.js</fo:marker><fo:block font-size="20.736pt">10.3. CoffeeScript with Backbone.js</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_security_stub"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">Security (stub)</fo:marker><fo:block font-size="24.8832pt">11. Security (stub)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block id="_xss_with_json_bootstrapping_stub"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">XSS with JSON bootstrapping (stub)</fo:marker><fo:block font-size="20.736pt">11.1. XSS with JSON bootstrapping (stub)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">Use <fo:inline font-size="10pt" font-family="monospace">json2.js</fo:inline> and:</fo:block><fo:block id="idp4679424" text-align="start" wrap-option="no-wrap" space-before.minimum="0.8em" space-before.optimum="1em" space-before.maximum="1.2em" space-after.minimum="0.8em" space-after.optimum="1em" space-after.maximum="1.2em" hyphenate="false" white-space-collapse="false" white-space-treatment="preserve" linefeed-treatment="preserve" font-size="10pt" font-family="monospace" background-color="#E0E0E0" border="0">&lt;script type="text/json" id="something"&gt;
  &lt;%= something.to_json %&gt;
&lt;/script&gt;

&lt;script type="text/javascript"&gt;
  (function () {
    var something = JSON.parse($('#something').text());
    someJavascriptFunction(something);
  })();
&lt;/script&gt;</fo:block></fo:block><fo:block id="_xss_in_html_templates_stub"><fo:block><fo:block><fo:block margin-left="0pt" font-family="sans-serif,Symbol,ZapfDingbats" keep-together.within-column="always"><fo:block keep-with-next.within-column="always"><fo:block font-family="sans-serif" font-weight="bold" keep-with-next.within-column="always" space-before.minimum="0.8em" space-before.optimum="1.0em" space-before.maximum="1.2em" text-align="start" start-indent="0pt"><fo:marker marker-class-name="section.head.marker">XSS in HTML templates (stub)</fo:marker><fo:block font-size="20.736pt">11.2. XSS in HTML templates (stub)</fo:block></fo:block></fo:block></fo:block></fo:block></fo:block><fo:block space-before.optimum="1em" space-before.minimum="0.8em" space-before.maximum="1.2em">TODO: Discuss <fo:inline font-size="10pt" font-family="monospace">Backbone.Model.escape</fo:inline>, <fo:inline font-size="10pt" font-family="monospace">_.escape</fo:inline>, defaulting to escape with <fo:inline font-size="10pt" font-family="monospace">&lt;%=</fo:inline> vs <fo:inline font-size="10pt" font-family="monospace">&lt;%==</fo:inline>, escaping in other templating.</fo:block></fo:block></fo:block></fo:flow></fo:page-sequence></fo:root>
